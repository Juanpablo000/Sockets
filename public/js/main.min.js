const chatForm=document.getElementById("chat-form"),chatMessages=document.querySelector(".chat-messages"),roomName=document.getElementById("room-name"),userList=document.getElementById("users");function ocultarAllSections(){let e=document.getElementsByTagName("section");for(let t of e)t.classList.add("ocultar")}function irA(e){e>=0&&e<document.getElementsByTagName("section").length&&(ocultarAllSections(),document.getElementsByTagName("section")[e].classList.remove("ocultar"))}window.onload=()=>{ocultarAllSections(),validar()};const{username:username,room:room}=Qs.parse(location.search,{ignoreQueryPrefix:!0});function validar(){irA(null!=username?1:0)}const socket=io();function mensajeSalida(e){const t=document.createElement("div");t.classList.add("message"),t.innerHTML=`<p class="meta">${e.username} <span>${e.time}</span></p>\n  <p class="text">\n   ${e.text}\n  </p>`,document.querySelector(".chat-messages").appendChild(t)}function outputRoomName(e){roomName.innerText=e}function outputUsers(e){userList.innerHTML="",e.forEach((e=>{const t=document.createElement("li");t.innerText=e.username,userList.appendChild(t)}))}socket.emit("joinRoom",{username:username,room:room}),socket.on("roomUsers",(({room:e,users:t})=>{outputRoomName(e),outputUsers(t)})),socket.on("message",(e=>{console.log(e),mensajeSalida(e),chatMessages.scrollTop=chatMessages.scrollHeight})),chatForm.addEventListener("submit",(e=>{e.preventDefault();let t=e.target.elements.msg.value;socket.emit("chatMessage",t),e.target.elements.msg.value="",e.target.elements.msg.focus()}));const moment=require("moment");function formatMessage(e,t){return{username:e,text:t,time:moment().format("h:mm a")}}module.exports=formatMessage;const users=[];function userJoin(e,t,s){const o={id:e,username:t,room:s};return users.push(o),o}function getCurrentUser(e){return users.find((t=>t.id===e))}function userLeave(e){const t=users.findIndex((t=>t.id===e));if(-1!==t)return users.splice(t,1)[0]}function getRoomUsers(e){return users.filter((t=>t.room===e))}module.exports={userJoin:userJoin,getCurrentUser:getCurrentUser,userLeave:userLeave,getRoomUsers:getRoomUsers};